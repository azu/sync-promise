define(function(){function n(n){return n&&"function"==typeof n.then}function t(t){function u(n,t){if(i.a=f,i.v=n,i.s=t,t===r&&!i.c[t].length)throw n;i.c[t].forEach(function(t){t(n)}),i.c=null}function h(t){i.c&&(n(t)?t.then(h).catch(e):u(t,o))}function e(t){i.c&&(n(t)?t.then(e).catch(e):u(t,r))}var i=this;i.v=0,i.s=c,i.c=[[],[]],i.a=!1;var f=!0;t(h,e),f=!1}var c=2,o=0,r=1,u=t.prototype;return u.then=function(n){var c=this;if(c.a)throw new Error("Can not call then on synchonously resolved promise");return new t(function(t,u){function h(){try{t(n(c.v))}catch(o){u(o)}}c.s===o?h():c.s===r?u(c.v):(c.c[o].push(h),c.c[r].push(u))})},u.catch=function(n){var c=this;if(c.a)throw new Error("Can not call catch on synchonously resolved promise");return new t(function(t,u){function h(){try{t(n(c.v))}catch(o){u(o)}}c.s===r?h():c.s===o?t(c.v):(c.c[r].push(h),c.c[o].push(t))})},t.all=function(c){return new t(function(t,o,r){r=c.length,c.forEach(function(u,h){n(u)?u.then(function(n){c[h]=n,--r||t(c)}).catch(o):--r||t(c)})})},t});