define(function(){function n(n){return n&&"function"==typeof n.then}function t(t){function e(n,t){r.v=n,r.s=t,t!==u||r.c[t].length||setTimeout(function(){r.h||(console.log("Potentially uncought rejection"),console.log(r.v))}),r.c[t].forEach(function(t){t(n)}),r.c=null}function i(t){r.c&&(n(t)?t.then(i).catch(h):e(t,o))}function h(t){r.c&&(n(t)?t.then(h).catch(h):e(t,u))}var r=this;r.v=0,r.s=c,r.c=[[],[]],r.h=!1;try{t(i,h)}catch(f){h(f)}}var c=2,o=0,u=1;t.resolve=function(c){return n(c)?c:new t(function(n){n(c)})},t.reject=function(c){return n(c)?c:new t(function(n,t){t(c)})};var e=t.prototype;return e.then=function(n){var c=this;return new t(function(t,e){function i(){try{t(n(c.v))}catch(o){e(o)}}c.s===o?i():c.s===u?(c.h=!0,e(c.v)):(c.c[o].push(i),c.c[u].push(e))})},e.catch=function(n){var c=this;return new t(function(t,e){function i(){try{t(n(c.v))}catch(o){e(o)}}c.s===u?(c.h=!0,i()):c.s===o?t(c.v):(c.c[u].push(i),c.c[o].push(t))})},t.all=function(c){return new t(function(t,o,u){u=c.length,c.forEach(function(e,i){n(e)?e.then(function(n){c[i]=n,--u||t(c)}).catch(o):--u||t(c)})})},t});