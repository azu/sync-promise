define(function(){function n(n){return n&&"function"==typeof n.then}function t(t){function r(n,t){i.v=n,i.s=t,i.c[t].forEach(function(t){t(n)}),i.c=null}function e(t){i.c&&(n(t)?(t.then(e),t.catch(f)):r(t,u))}function f(t){i.c&&(n(t)?(t.then(f),t.catch(f)):r(t,o))}var i=this;i.v=0,i.s=c,i.c=[[],[]];try{t(e,f)}catch(h){f(h)}}var c=3,u=0,o=1;t.resolve=function(c){return n(c)?c:new t(function(n){n(c)})},t.reject=function(c){return n(c)?c:new t(function(n,t){t(c)})};var r=t.prototype;return r.then=function(n){var c=this;return new t(function(t,r){function e(){try{t(n(c.v))}catch(u){r(u)}}c.s===u?e():c.s===o?r(c.v):(c.c[u].push(e),c.c[o].push(r))})},r.catch=function(n){var c=this;return new t(function(t,r){function e(){try{t(n(c.v))}catch(u){r(u)}}c.s===o?e():c.s===u?t(c.v):(c.c[o].push(e),c.c[u].push(t))})},t.all=function(c){return new t(function(t,u,o){o=c.length,c.forEach(function(r,e){n(r)?r.then(function(n){c[e]=n,--o||t(c)}).catch(u):--o||t(c)})})},t});